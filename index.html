<html>
<head>
  <script src="peg-0.8.0.min.js"></script>
</head>
<body>
  <textarea id="score">INS 0 1 ;
OSC P5 P6 B2 F2 P30 ;
OUT B2 B1 ;
END ;
GEN 0 1 2 0 0 .999 50 .999 205 -.999 306 -.999 461 0 511 ;
NOT 0 1 .50 125 8.45 ;
NOT .75 1 .17 250 8.45 ;
NOT 1.00 1 .50 500 8.45 ;
NOT 1.75 1 .17 1000 8.93 ;
NOT 2.00 1 .95 2000 10.04 ;
NOT 3.00 1 .95 1000 8.45 ;
NOT 4.00 1 .50 500 8.93 ;
NOT 4.75 1 .17 500 8.93 ;
NOT 5.00 1 .50 700 8.93 ;
NOT 5.75 1 .17 1000 13.39 ;
NOT 6.00 1 1.95 2000 12.65 ;
TER 8.00 ;
</textarea>
  <textarea id="grammar">
score
  = lines:line* { return {lines: lines}; }

line
  = terminator
  / begin_instrument
  / oscillator
  / output
  / end_instrument
  / generated_function
  / note

terminator
  = operation:"TER" " " time:variable ";\n" { return {operation: operation, time:parseFloat(time)}; }

begin_instrument
  = operation:"INS" " " time:variable number:variable ";\n" { return {operation: operation, time:parseFloat(time), number:parseInt(number)}; }

oscillator
  = operation:"OSC" " " amplitude:variable frequency:variable output:variable stored_function:variable initial_value:variable ";\n" { return {operation: operation, amplitude: amplitude, frequency: frequency, output: output, stored_function: stored_function, initial_value: initial_value }; }

output
  = operation:"OUT" " " input:variable output:variable ";\n" { return {operation: operation, input: input, output: output }; }

end_instrument
  = operation:"END" " " ";\n" { return {operation: operation }; }

generated_function
  = operation:"GEN" " " time:variable subroutine_number:variable function_number:variable params:variable* ";\n" { return { operation: operation, time: parseFloat(time), subroutine_number: subroutine_number, function_number: function_number, params:params }; }

note
  = operation:"NOT" " " time:variable instrument_number:variable duration:variable params:variable* ";\n" { return { operation: operation, time: parseFloat(time), instrument_number: parseInt(instrument_number), duration: parseFloat(duration), params:params }; }

variable
  = letters:[^ ;]+ " "* { return letters.join(""); }

</textarea>
  <script src="musicn.js"></script>


</body>
</html>
