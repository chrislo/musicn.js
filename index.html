<html>
<head>
  <script src="peg-0.8.0.min.js"></script>
</head>
<body>
  <textarea id="score">INS 0 1 ;
OSC P5 P6 B2 F2 P30 ;
OUT B2 B1 ;
END ;
GEN 0 1 2 0 0 .999 50 .999 205 -.999 306 -.999 461 0 511 ;
NOT 0 1 .50 125 8.45 ;
NOT .75 1 .17 250 8.45 ;
NOT 1.00 1 .50 500 8.45 ;
NOT 1.75 1 .17 1000 8.93 ;
NOT 2.00 1 .95 2000 10.04 ;
NOT 3.00 1 .95 1000 8.45 ;
NOT 4.00 1 .50 500 8.93 ;
NOT 4.75 1 .17 500 8.93 ;
NOT 5.00 1 .50 700 8.93 ;
NOT 5.75 1 .17 1000 13.39 ;
NOT 6.00 1 1.95 2000 12.65 ;
TER 8.00 ;
</textarea>
  <textarea id="grammar">
score
  = data_statements:data_statement* { return {data_statements:data_statements}; }

data_statement
  = data_statement: (generated_function
  / note
  / terminator
  / instrument_definition) eol { return data_statement; }

instrument_definition
  = begin_instrument:begin_instrument eol unit_generators:unit_generator_data_statement* end_instrument { return {time: begin_instrument.time, number: begin_instrument.number, unit_generators: unit_generators}; }

unit_generator_data_statement
  = unit_generator: (oscillator
  / output) eol { return unit_generator; }

terminator
  = operation:"TER" whitespace time:variable  { return {operation: operation, time:parseFloat(time)}; }

begin_instrument
  = operation:"INS" whitespace time:variable number:variable  { return {operation: operation, time:parseFloat(time), number:parseInt(number)}; }

oscillator
  = operation:"OSC" whitespace amplitude:variable frequency:variable output:variable stored_function:variable initial_value:variable  { return {operation: operation, amplitude: amplitude, frequency: frequency, output: output, stored_function: stored_function, initial_value: initial_value }; }

output
  = operation:"OUT" whitespace input:variable output:variable  { return {operation: operation, input: input, output: output }; }

end_instrument
  = operation:"END" whitespace  { return {operation: operation }; }

generated_function
  = operation:"GEN" whitespace time:variable subroutine_number:variable function_number:variable points:point*  { return { operation: operation, time: parseFloat(time), subroutine_number: subroutine_number, function_number: function_number, points:points }; }

point
  = amplitude:variable index:variable { return {amplitude: parseFloat(amplitude), index: parseInt(index)}; }

note
  = operation:"NOT" whitespace time:variable instrument_number:variable duration:variable params:variable*  { return { operation: operation, time: parseFloat(time), instrument_number: parseInt(instrument_number), duration: parseFloat(duration), params:params }; }

variable
  = letters:[^ ;]+ whitespace* { return letters.join(""); }

whitespace
  = " "

eol
  = ";\n"
</textarea>
  <script src="musicn.js"></script>


</body>
</html>
